<meta charset="utf-8">
<?php
    require_once "symbolsData.php";
    $biaozhuarray=array();//从数据库获取起始\中止\标签ID
    $idColors=array();//从数据库中获取颜色键值对，索引为ID，值为对应的颜色
    $idMeaning=array();////从数据库中获取意思，索引为ID，值为对应的意思
    $idMeaning["id"]="李应龙124f算法哥哥和";
    $idColors["id"]="#00ff00";
    $rowHeightData=array();//每排行高，值为对应的颜色，方便后面调整
    $article="·. , :'?/\< >\" [] {} ()-+ =_|~;!@#$%^&*`0987654321+abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ^——《》【】？，。；‘”！……黑''''''''''Gary Lineker reinstated after BBC suspension for tweet on ‘cruel’ UK refugee policy Britain's BBC reinstated its highest-paid presenter Gary Lineker on Monday after its suspension of the former England football captain for criticizing state immigration policy. WORLD MAR 13 BBC offices in India searched by tax officials after controversial Modi documentary Officials from India's Income Tax Department searched the BBC's offices in New Delhi and Mumbai, weeks after it broadcast a documentary about Prime Minister Narendra Modi.格尔曾经说过，只有永远躺在泥坑里的人，才不会再掉进坑里。这不禁令我深思。 3月27日，山东。女子挑战穿10公分高跟鞋爬泰山，画面中女子边拄着拐杖边拍视频记录爬山过程。女生表示：泰山治服了每个嘴硬的人，但治服不了脚硬的人。网友：上山容易下山难。罗曼·罗兰曾经说过，只有把抱怨环境的心情，化为上进的力量，才是成功的保证。带着这句话，我们还要更加慎重的审视这个问题： 我们都知道，只要有意义，那么就必须慎重考虑。 龙哥，发生了会如何，不发生又会如何。 我认为， 了解清楚龙哥到底是一种怎么样的存在，是解决一切问题的关键。 总结的来说， 一般来讲，我们都必须务必慎重的考虑考虑。 了解清楚龙哥到底是一种怎么样的存在，是解决一切问题的关键。 总结的来说， 在这种困难的抉择下，本人思来想去，寝食难安。 龙哥，到底应该如何实现。 一般来说， 我们都知道，只要有意义，那么就必须慎重考虑。 龙哥，到底应该如何实现。 龙哥，发生了会如何，不发生又会如何。 我认为， 我们都知道，只要有意义，那么就必须慎重考虑。 在这种困难的抉择下，本人思来想去，寝食难安。 我们都知道，只要有意义，那么就必须慎重考虑。 所谓龙哥，关键是龙哥需要如何写。 总结的来说， 问题的关键究竟为何? 要想清楚，龙哥，到底是一种怎么样的存在。 总结的来说， 在这种困难的抉择下，本人思来想去，寝食难安。 莎士比亚曾经说过，人的一生是短的，但如果卑劣地过这一生，就太长了。带着这句话，我们还要更加慎重的审视这个问题： 要想清楚，龙哥，到底是一种怎么样的存在。 现在，解决龙哥的问题，是非常非常重要的。 所以， 在这种困难的抉择下，本人思来想去，寝食难安。 那么， 我们都知道，只要有意义，那么就必须慎重考虑。 经过上述讨论我们一般认为，抓住了问题的关键，其他一切则会迎刃而解。 总结的来说， 了解清楚龙哥到底是一种怎么样的存在，是解决一切问题的关键。 问题的关键究竟为何? 我认为， 我们不得不面对一个非常尴尬的事实，那就是， 问题的关键究竟为何? 既然如何， 这种事实对本人来说意义重大，相信对这个世界也是有一定意义的。 现在，解决龙哥的问题，是非常非常重要的。 所以， 就我个人来说，龙哥对我的意义，不能不说非常重大。 希腊曾经说过，最困难的事情就是认识自己。我希望诸位也能好好地体会这句话。 邓拓在不经意间这样说过，越是没有本领的就越加自命不凡。我希望诸位也能好好地体会这句话。 所谓龙哥，关键是龙哥需要如何写。 要想清楚，龙哥，到底是一种怎么样的存在。 龙哥的发生，到底需要如何做到，不龙哥的发生，又会如何产生。 现在，解决龙哥的问题，是非常非常重要的。 所以， 带着这些问题，我们来审视一下龙哥。 西班牙曾经说过，自知之明是最难得的知识。这不禁令我深思。 了解清楚龙哥到底是一种怎么样的存在，是解决一切问题的关键。 德谟克利特在不经意间这样说过，节制使快乐增加并使享受加强。这句话语虽然很短，但令我浮想联翩。 要想清楚，龙哥，到底是一种怎么样的存在。 这种事实对本人来说意义重大，相信对这个世界也是有一定意义的。 总结的来说， 莎士比亚在不经意间这样说过，人的一生是短的，但如果卑劣地过这一生，就太长了。我希望诸位也能好好地体会这句话。 我们不得不面对一个非常尴尬的事实，那就是， 带着这些问题，我们来审视一下龙哥。 史美尔斯在不经意间这样说过，书籍把我们引入最美好的社会，使我们认识各个时代的伟大智者。这启发了我， 经过上述讨论龙哥的发生，到底需要如何做到，不龙哥的发生，又会如何产生。 龙哥的发生，到底需要如何做到，不龙哥的发生，又会如何产生。 我们不得不面对一个非常尴尬的事实，那就是， 白哲特在不经意间这样说过，坚强的信念能赢得强者的心，并使他们变得更坚强。 这句话语虽然很短，但令我浮想联翩。 每个人都不得不面对这些问题。 在面对这种问题时， 我们都知道，只要有意义，那么就必须慎重考虑。 龙哥因何而发生?我们一般认为，抓住了问题的关键，其他一切则会迎刃而解。 那么， 龙哥因何而发生?带着这些问题，我们来审视一下龙哥。 总结的来说， 这种事实对本人来说意义重大，相信对这个世界也是有一定意义的。 在这种困难的抉择下，本人思来想去，寝食难安。 龙哥的发生，到底需要如何做到，不龙哥的发生，又会如何产生。 经过上述讨论所谓龙哥，关键是龙哥需要如何写。 要想清楚，龙哥，到底是一种怎么样的存在。 既然如此， 总结的来说， 本人也是经过了深思熟虑，在每个日日夜夜思考这个问题。 我们不得不面对一个非常尴尬的事实，那就是， 既然如此， 查尔斯·史考伯曾经说过，一个人几乎可以在任何他怀有无限热忱的事情上成功。 带着这句话，我们还要更加慎重的审视这个问题： 伏尔泰在不经意间这样说过，不经巨大的困难，不会有伟大的事业。这启发了我， 龙哥，到底应该如何实现。 一般来说， 生活中，若龙哥出现了，我们就不得不考虑它出现了的事实。 了解清楚龙哥到底是一种怎么样的存在，是解决一切问题的关键。 现在，解决龙哥的问题，是非常非常重要的。 所以， 总结的来说， 佚名曾经说过，感激每一个新的挑战，因为它会锻造你的意志和品格。这启发了我， 我们一般认为，抓住了问题的关键，其他一切则会迎刃而解。 现在，解决龙哥的问题，是非常非常重要的。 所以， 一般来说， 我们不得不面对一个非常尴尬的事实，那就是， 问题的关键究竟为何? 我们一般认为，抓住了问题的关键，其他一切则会迎刃而解。 我们都知道，只要有意义，那么就必须慎重考虑。 在这种困难的抉择下，本人思来想去，寝食难安。";
    $length=1600;//文章长度
    $articleArray=contentSplit($article,$length,$symbols);$wenzhang="";
    //echo file_get_contents('php://input');
    for($i=0;$i<count($articleArray);$i++){
        $rowHeightData[$i]=51;//初始每行间距
    }
    function rand_color() {
        return '#' . str_pad(dechex(mt_rand(0, 0xFFFFFF)), 6, '0', STR_PAD_LEFT);
    }
    function getRectPosition($st,$articleArray,$symbols,$rowHeightData){
        //传入行，起始，中止，ID的字符串$st、文章切割列表、字符长度数据、每行间距(向下为正+向上为负-)
        //计算矩形的位置坐标和宽度，支出英文字母符号中文符号数字
        //依据长度判断是否是分行标签
        $node=explode(",",$st);
        $y=0;
        $x=10;
        $width=0;
        $codestr="zabcdefghijklmnopqrstuvwxyzZABCDEFGHIJKLMNOPQRSTUVWXYZ<>?/,.:'\";~!@#$%^&*()`\\|[]{}+_- ·=…  ";//不要改动字符串顺序z为起位符
        $codestr1="0123456789";
        for($i=0;$i<$node[0]+1;$i++){
            $y+=$rowHeightData[$i];
        }
        for($i=0;$i<mb_strlen(mb_substr($articleArray[$node[0]],0,$node[1],"utf-8"),"utf-8");$i++){
            if(mb_substr($articleArray[$node[0]],$i,1,"utf-8")=="z"||strpos($codestr,mb_substr($articleArray[$node[0]],$i,1,"utf-8"))){
                if(isset($symbols[mb_substr($articleArray[$node[0]],$i,1,"utf-8")])){
                    $x+=$symbols[mb_substr($articleArray[$node[0]],$i,1,"utf-8")];
                }
            }else if(mb_substr($articleArray[$node[0]],$i,1,"utf-8")=="0"||strpos($codestr1,mb_substr($articleArray[$node[0]],$i,1,"utf-8")))
            {
                    $x+=9.38;
            }else{
                    $x+=16;
            }
        }
        if(count($node)==5){
            //第一行x,y,width,++,width,ID
            //传入行，起、++++、终 标签ID,第几行起始,+代表跨了几行
            echo "多行";
            $widths=array();$widths[0]=0;$widths[1]=0;
            $len1=mb_strlen(mb_substr($articleArray[$node[0]],$node[1],mb_strlen($articleArray[$node[0]],"utf-8")-$node[1],"utf-8"),"utf-8");
            $len2=mb_strlen(mb_substr($articleArray[$node[0]+substr_count($node[2],"+")],0,$node[3],"utf-8"),"utf-8");
            for($i=0;$i<$len1;$i++){
                $single=mb_substr(mb_substr($articleArray[$node[0]],$node[1],mb_strlen($articleArray[$node[0]],"utf-8")-$node[1],"utf-8"),$i,1,"utf-8");
                if($single=="z"||strpos($codestr,$single)){
                    if(isset($symbols[$single])){
                        $widths[0]+=$symbols[$single];
                    }
                }else if($single=="0"||strpos($codestr1,$single))
                {
                    $widths[0]+=9.38;
                }else{
                    $widths[0]+=16;
                }
            }
            for($i=0;$i<$len2;$i++){
                $single=mb_substr(mb_substr($articleArray[$node[0]+substr_count($node[2],"+")],0,$node[3],"utf-8"),$i,1,"utf-8");
                if($single=="z"||strpos($codestr,$single)){
                    if(isset($symbols[$single])){
                        $widths[1]+=$symbols[$single];
                    }
                }else if($single=="0"||strpos($codestr1,$single))
                {
                    $widths[1]+=9.38;
                }else{
                    $widths[1]+=16;
                }
            }
            return $x.",".$y.",".$widths[0].",".$node[2].",".$widths[1].",".$node[4].",".$node[0];
        }else if(count($node)==4)
        {
            //第一行x,y,width,ID
            echo "单行";
            for($i=0;$i<mb_strlen(mb_substr($articleArray[$node[0]],$node[1],$node[2]-$node[1],"utf-8"),"utf-8");$i++){
                $single=mb_substr(mb_substr($articleArray[$node[0]],$node[1],$node[2]-$node[1],"utf-8"),$i,1,"utf-8");
                if($single=="z"||strpos($codestr,$single)){
                    if(isset($symbols[$single])){
                        $width+=$symbols[$single];
                    }
                }else if($single=="0"||strpos($codestr1,$single))
                {
                    $width+=9.38;
                }else{
                    $width+=16;
                }
            }
            return $x.",".$y.",".$width.",".$node[3];
        }
        return "Error from function getRectPosition";
    }
    function rowModeConvert($st,$articleArray){
        //传入整个文章的起、终、标签ID,转换为 行，起，终，ID
        $node=explode(",",$st);
        $id=$node[2];
        $temp=$node[0];
        $startIndex=$node[0];
        $endIndex=0;
        $row=0;
        $result="error";
        for($i=0;$temp>=0;$i++){
            $temp-=mb_strlen($articleArray[$i],"utf-8");
            $row=$i;
            if($temp>0){
                $startIndex=$temp;
            }else if($temp==0){
                $startIndex=0;
            }
        } 
        $endIndex=$startIndex+$node[1]-$node[0];
        if($endIndex>mb_strlen($articleArray[$row],"utf-8")){
            //多行标签 行，起、++++、终2、标签ID,+代表跨了几行
            $index="";
            $j=$row;
            while($endIndex>mb_strlen($articleArray[$j],"utf-8")){
                $endIndex=$endIndex-mb_strlen($articleArray[$j],"utf-8");//第二段必定从第$row+1行，位置0开始
                $index=$index."+";
                $j++;
            }
            $result=$row.",".$startIndex.",".$index.",".$endIndex.",".$id;
        }else{
            //单行标签 行，起、终、标签ID
            $result=$row.",".$startIndex.",".$endIndex.",".$id;
        }
        echo $result;
        return $result;
    }
    function textModeConvert($st,$articleArray){
        //传入行，起，终，ID,转换为 整个文章的起、终、标签ID
        $node=explode(",",$st);
        $startIndex=0;
        var_dump($node);
        if(count($node)==5){
            for($i=0;$i<$node[0];$i++){
                $startIndex+=mb_strlen($articleArray[$i],"utf-8");
            }
            $startIndex+=$node[1];
            $endIndex=mb_strlen($articleArray[$node[0]],"utf-8")-$node[1]+$startIndex+$node[3];
            for($i=$node[0]+1;$i<substr_count($node[2],"+")+$node[0];$i++){
                $endIndex+=mb_strlen($articleArray[$i],"utf-8");
            }
            return  $startIndex.",".$endIndex.",".$node[4];
        }else if(count($node)==4)
        {
            for($i=0;$i<$node[0];$i++){
                $startIndex+=mb_strlen($articleArray[$i],"utf-8");
            }
            $startIndex+=$node[1];
            $endIndex=$node[2]-$node[1]+$startIndex;
            echo $startIndex.",".$endIndex;
            return  $startIndex.",".$endIndex.",".$node[3];
        }
        return "error in function textModeConvert";
    }
    function contentSplit($wenzhang,$length,$symbols)
    {
        //函数作用是将内容排版，返回一个切割了文章内容的字符串数组
        //length是规定的文章长度参数
        $lastlocation=0;
        $splitnum=0;
        $templength=0;
        $wenzhangarray=array();
        $codestr="zabcdefghijklmnopqrstuvwxyzZABCDEFGHIJKLMNOPQRSTUVWXYZ<>?/,.:'\";~!@#$%^&*()`\\|[]{}+_- ·=…  ";//不要改动字符串顺序z为起位符
        $codestr1="0123456789";
        for($i=0;$lastlocation<mb_strlen($wenzhang,"utf-8");$i++,$templength=0){
            for($j=$lastlocation;($templength<$length);$j++){
                //echo " ".$j;
                if(($j<mb_strlen($wenzhang,"utf-8"))&&(mb_substr($wenzhang,$j,1,"utf-8")=="z"||strpos($codestr,mb_substr($wenzhang,$j,1,"utf-8")))){
                    if(isset($symbols[mb_substr($wenzhang,$j,1,"utf-8")])){
                        $templength+=$symbols[mb_substr($wenzhang,$j,1,"utf-8")];
                    }
                }else if(($j<mb_strlen($wenzhang,"utf-8"))&&(mb_substr($wenzhang,$j,1,"utf-8")=="0"||strpos($codestr1,mb_substr($wenzhang,$j,1,"utf-8")))){
                    $templength=$templength+9.38;//数字
                }else{
                    $templength=$templength+16;//汉字
                }
                $splitnum=$j-$lastlocation;
            }
            $wenzhangarray[$i]=mb_substr($wenzhang,$lastlocation,$splitnum,"utf-8");
            $lastlocation=$lastlocation+$splitnum;
        }
        return $wenzhangarray;
    }
    if(isset($_POST["selectedText"])){
        echo "I got it!!! ";
        $st=textModeConvert($_POST["selectedText"].",id",$articleArray);
        echo "wanlingyun ".$st."wanlingyun ";
        rowModeConvert($st.",asf",$articleArray);
        echo $_POST["selectedText"].",id";
        $biaozhuarray[0]=getRectPosition($_POST["selectedText"].",id",$articleArray,$symbols,$rowHeightData);
        $testa=rowModeConvert("176,196,id",$articleArray);
        $biaozhuarray[1]=getRectPosition($testa,$articleArray,$symbols,$rowHeightData);
        var_dump($biaozhuarray);
    }else{
        //上传数据库
    }
    $TT="";
    // $testq=array();
    // $biaozhuarray[0]=getRectPosition("0,6,58,id",$articleArray,$symbols,$rowHeightData);
    // $biaozhuarray[0]=getRectPosition("20,73,+++,61,id",$articleArray,$symbols,$rowHeightData);
    // $biaozhuarray[1]=getRectPosition("0,176,+,85,id",$articleArray,$symbols,$rowHeightData);
    // $biaozhuarray[2]=getRectPosition("1,108,+,67,id",$articleArray,$symbols,$rowHeightData);
    // $biaozhuarray[3]=getRectPosition("4,60,++,64,id",$articleArray,$symbols,$rowHeightData);
    // $biaozhuarray[4]=getRectPosition("6,67,+,24,id",$articleArray,$symbols,$rowHeightData);
    // $biaozhuarray[5]=getRectPosition("7,78,++,77,id",$articleArray,$symbols,$rowHeightData);
    // $biaozhuarray[6]=getRectPosition("10,97,++,1,id",$articleArray,$symbols,$rowHeightData);
    // $biaozhuarray[7]=getRectPosition("12,24,+,21,id",$articleArray,$symbols,$rowHeightData);
    // $biaozhuarray[8]=getRectPosition("13,22,+,8,id",$articleArray,$symbols,$rowHeightData);
    // $biaozhuarray[9]=getRectPosition("18,10,48,id",$articleArray,$symbols,$rowHeightData);
    // $biaozhuarray[10]=getRectPosition("20,73,+++,61,id",$articleArray,$symbols,$rowHeightData);
    $testq[0]=rowModeConvert("6,58,id",$articleArray);
    $testq[1]=rowModeConvert("176,266,id",$articleArray);
    $testq[2]=rowModeConvert("289,457,id",$articleArray);
    $testq[3]=rowModeConvert("788,996,id",$articleArray);
    $testq[4]=rowModeConvert("999,1060,id",$articleArray);
    $testq[5]=rowModeConvert("1114,1322,id",$articleArray);
    $testq[6]=rowModeConvert("1444,1556,id",$articleArray);
    $testq[7]=rowModeConvert("1579,1678,id",$articleArray);
    $testq[8]=rowModeConvert("1679,1767,id",$articleArray);
    $testq[9]=rowModeConvert("2178,2216,id",$articleArray);
    $testq[10]=rowModeConvert("2448,2745,id",$articleArray);
    for($i=0;$i<count($testq);$i++){
        $biaozhuarray[$i]=getRectPosition($testq[$i],$articleArray,$symbols,$rowHeightData);
    }
    $biaozhuarray[0]=getRectPosition("0,134,145,id",$articleArray,$symbols,$rowHeightData);
    // var_dump($testq);
    // var_dump($biaozhuarray);
?>
<!DOCTYPE html>
<html>
	<head>
		<title>信息抽取平台</title>
	</head>
	<link rel="stylesheet" type="text/css" href="CSS/file_annotation.css" />
	<script src="JS/Jquery.js"></script>
	<body>
		<div>
			<div id="header" class="header"><!-- 网页最上方TOP-->
                <div class="headerTitlepic"><!-- 网页最上方TOP左侧LOGO位置 -->
                    <img src="image/webtitle.png" width="380px" height="50px" style="margin: auto;position: relative;top: 0;left: 20px;bottom: 0;right: 0;"/><!--LOGO图片-->
                </div>
                <div id="headerUser" class="headerUser">
                    <img src="image/icon/user.png" height="45px" width="45px"/>
                    <div style="text-align: center;margin-top: 0px ; position: absolute; top:10px;left:50px;" >李应龙</div>
                </div><!-- 网页最上方TOP右侧用户位置 -->
			</div>
			<div id="leftMenu" class="leftMenu"><!-- 网页左侧Left跳转功能栏 -->
				<ul class="leftMenulist">
                    <li onclick="pageJump('file_list')"><span style="display: block; text-align: center; line-height: 50px; color: white; ">文章列表</span></li><!-- 按钮内容 -->
                    <li onclick="pageJump('user_admin')"><span style="display: block; text-align: center; line-height: 50px; color: white; ">用户管理</span></li>
                    <li onclick="pageJump('')"><span style="display: block; text-align: center; line-height: 50px; color: white; ">日志</span></li>
                    <li onclick="pageJump('')"><span style="display: block; text-align: center; line-height: 50px; color: white; ">数据备份站</span></li>
				</ul>
			</div>	
			<div style="">
				<div class="fileInfocontainer"><!-- 作用是加上文件信息 -->
					<div style="position: relative; float: left;width: 50px;height: 43px;border: #00ff00 solid 1px;"><!-- 装入文件图片 -->
						<img src="image/icon/txt_icon.png" height="30px" width="30px" style="margin: auto;position: absolute;top: 0;left: 0;bottom: 0;right: 0;">
					</div>
					文件：龙的秘密
				</div class="fileInfocontainer">
                <div class="labelInfocontainer">
                        <div class="label_box">
                            实体标签：
                            <span class="label_nav">默认标签_1</span>
                            <span class="label_nav">默认标签_2</span>
                            <button id="add_substance" name="add_substance" class="addLabel_button"  >添加实体标签</button>
                        </div>
                        <div class="label_box" ">
                            关系标签：
                            <span class="label_nav">默认标签</span>
                            <span class="label_nav">默认标签</span>
                            <button id="add_relation" name="add_relation" class="addLabel_button"  >添加关系标签</button>
                        </div>
                </div><!-- svg汉字=16 10+16*i+... 小写字母8 大写字母10 括号空格字符6 -->
                <form id="selectedTextForm" action="" method="post">
                    <input type="hidden" id="selectedText" name="selectedText" value=""/>
                </form>
					<div id="svgMaincontainer" onmouseup="getSelectText()" id='text' class="svgMaincontainer"><!-- 作用是加上个滚动条 -->
                        <svg id="svgArticle" style=" background-color:lavender;width: 1642px;height: <?php $svgHeight=0;for($i=0;$i<count($rowHeightData);$i++){$svgHeight+=1+$rowHeightData[$i];} echo $svgHeight;?>px;" xmlns="http://www.w3.org/2000/svg"><!-- svg框，需要改变 height 属性增加滚动条的量,width固定长度 -->
                            <?php
                                for($i=0;$i<Count($biaozhuarray);$i++)
                                {
                                $node=explode(",",$biaozhuarray[$i]);
                                $x=$node[0];
                                $y=$node[1];
                                $width=$node[2];
                                if(count($node)==4){
                                    $TT=$TT."单";
                                    $color=$idColors[$node[3]];
                                    echo "<g><rect width='$width' height='17' x='$x' y='$y' fill='$color' rx='5' ry='5' /></g>";
                                    $Meaning=$idMeaning[$node[3]];
                                    //绘制标签名
                                    $y-=5;
                                    $textlength=mb_strlen($idMeaning[$node[3]],"utf-8")*12;
                                    echo "<text textlength='$textlength' font-size='12px'><tspan id='unknown' x='$x' y='$y'>$Meaning</tspan></text>";
                                }else if(count($node)==7)
                                {
                                    $TT=$TT."双";
                                    $color=$idColors[$node[5]];
                                    $sumY=$y;
                                    echo "<g><rect width='$width' height='17' x='$x' y='$y' fill='$color' rx='5' ry='5' /></g>";
                                    //绘制标签名
                                    $Meaning=$idMeaning[$node[5]];
                                    $textlength=mb_strlen($Meaning,"utf-8")*12;
                                    $y-=5;
                                    echo "<text textlength='$textlength' fill='#222222' font-size='12px'><tspan id='unknown' x='$x' y='$y'>$Meaning</tspan></text>";
                                    $y+=5;
                                    for($j=$node[6];$j<substr_count($node[3],"+")+$node[6];$j++){
                                        $sumY+=$rowHeightData[$j];
                                        $tempwidth=((substr_count($node[3],"+")+$node[6])==$j+1)?$node[4]:$length;
                                        echo "<g><rect width='$tempwidth' height='17' x='10' y='$sumY' fill='$color' rx='5' ry='5' /></g>";    
                                        }
                                }
                                }
                            ?>
                            <g><rect width="12" height="17" x="10" y="51" fill="#00ff00" rx="5" ry="5" /></g><!-- 中文汉字16 小写字母8.85 数字9.38 大写字符11.27 空格5 小点4.4 小问号7.74-->
                            <text style="white-space: pre; overflow-wrap: normal;" x="0" y="15" fill="black"><!-- svg框，需要改变 height 属性增加滚动条的量 -->
                            <!-- <tspan id="test" x='10' dy='51'><?php for($i=0;$i<100;$i++)echo "'"; ?></tspan> -->
                            <?php
                                for($i=0;$i<Count($articleArray);$i++)
                                {
                                echo "<tspan id='$i' x='10' dy='$rowHeightData[$i]'>$articleArray[$i]</tspan>";
                                }
                            ?>
                            </text>
                        </svg>
					</div>
			</div>
		</div>
        
        <button class="btn" id="JS_dialog">Click Me!</button>
        <!--遮罩层-->
        <div class="mask" id="dialog_mask"></div>
        <!--弹出框盒子-->
        <div class="dialog" id="dialogBox">
            <span style="display: inline-block;">标签设置</span><span class="dialog_close" style="display: inline-block;padding-left: 470px;border-bottom: 1px solid #eee;">x</span>
            <h5 id="select_text" class="dialog_title"></h5>
            <div id="select_index" class="dialog_content"></div>
        </div>
	</body>
	<script>
        function getCookie(cname) {
        
        let name = cname + "=";
        let ca = document.cookie.split(";");
        for (let i = 0; i < ca.length; i++) {
            let c = ca[i].trim();
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
        }
    }
        var scrollTop = 0;
        document.getElementById('svgMaincontainer').onscroll = function () {
        scrollTop = document.getElementById('svgMaincontainer').scrollTop || document.getElementById('svgMaincontainer').scrollTop;
        document.cookie="scrollTop=" + scrollTop;
        console.log(scrollTop);
        }
        console.log('<?php echo $TT; ?>');
        //滚动 清空  
        var scrollOldTop=getCookie("scrollTop");
        document.getElementById('svgMaincontainer').scrollTop=scrollOldTop;
        function getSelectText(){
            // console.log(getCookie("scrollTop"));
            // console.log(document.cookie);
            console.log(document.getElementById("unknown").textlength);
            if((!window.getSelection().isCollapsed)||window.getSelection().anchorNode.parentElement.tagName!="tspan"||window.getSelection().focusNode.parentElement.tagName!="tspan"){
                //判断是否选择为空并且是tspan
                if(window.getSelection().focusNode.parentElement==window.getSelection().anchorNode.parentElement){
                    startIndex=(window.getSelection().anchorOffset<window.getSelection().focusOffset)?window.getSelection().anchorOffset:window.getSelection().focusOffset;
                    EndIndex=(window.getSelection().anchorOffset>window.getSelection().focusOffset)?window.getSelection().anchorOffset:window.getSelection().focusOffset;
                    console.log("选取的文字："+window.getSelection().toString()+"————起始位置"+startIndex+"终止位置"+EndIndex+"第"+window.getSelection().focusNode.parentElement.id+"行");
                    var sendText=window.getSelection().focusNode.parentElement.id+","+startIndex+","+EndIndex;
                    console.log(sendText);
                    document.getElementById("selectedText").value=sendText;
            }else{
                    rowNumAbs=Math.abs(window.getSelection().focusNode.parentElement.id-window.getSelection().anchorNode.parentElement.id);
                    addRows="";
                    for(var i=0;i<rowNumAbs;i++){
                    addRows+="+";
                }
                if(window.getSelection().focusNode.parentElement.id>window.getSelection().anchorNode.parentElement.id){
                    //正选
                    var startIndex=window.getSelection().anchorOffset;
                    var EndIndex=window.getSelection().focusOffset;
                    var sendText=window.getSelection().anchorNode.parentElement.id+","+startIndex+","+addRows+","+EndIndex;
                    console.log(sendText);
                    document.getElementById("selectedText").value=sendText;
                    console.log("%c%s", "color: red; font-size: 24px;", "解除跨行封印");
                }else{
                    //反选
                    var startIndex=window.getSelection().focusOffset;
                    var EndIndex=window.getSelection().anchorOffset;
                    var sendText=window.getSelection().focusNode.parentElement.id+","+startIndex+","+addRows+","+EndIndex;
                    console.log(sendText);
                    document.getElementById("selectedText").value=sendText;
                    console.log("%c%s", "color: red; font-size: 24px;", "解除跨行封印");
                }
            }
            //document.getElementById("selectedTextForm").submit();
            }
            //判断是否选中
        }
	</script>
</html>
